<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Gerenciamento de Produtos - SGA</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <h:outputStylesheet library="css" name="style.css"/>
</h:head>

<h:body>
    <div class="layout-wrapper">
        <!-- Header -->
        <div class="layout-topbar">
            <div class="layout-topbar-logo">
                <h:link outcome="index">
                    <i class="pi pi-home"></i>
                    <span>SGA - Produtos</span>
                </h:link>
            </div>
            <div class="layout-topbar-menu">
                <h:link outcome="index" styleClass="topbar-link">
                    <i class="pi pi-home"></i>
                    <span>Início</span>
                </h:link>
                <h:link outcome="categorias" styleClass="topbar-link">
                    <i class="pi pi-tags"></i>
                    <span>Categorias</span>
                </h:link>
                <h:link outcome="usuarios" styleClass="topbar-link">
                    <i class="pi pi-users"></i>
                    <span>Usuários</span>
                </h:link>
            </div>
        </div>

        <!-- Main Content -->
        <div class="layout-main">
            <div class="layout-content">
                <div class="card">
                    <h1>
                        <i class="pi pi-box"></i>
                        Gerenciamento de Produtos
                    </h1>

                    <p:messages id="messages" showDetail="true" closable="true"/>

                    <!-- Toolbar -->
                    <p:toolbar styleClass="toolbar-actions">
                        <p:toolbarGroup align="left">
                            <p:commandButton value="Novo Produto" 
                                           icon="pi pi-plus" 
                                           styleClass="p-button-success"
                                           action="#{produtoController.prepararNovo}"
                                           update="dialogCadastro"
                                           oncomplete="PF('dialogCadastro').show()"/>
                        </p:toolbarGroup>
                        
                        <p:toolbarGroup align="right">
                            <p:inputText placeholder="Pesquisar por nome..." 
                                       value="#{produtoController.filtroNome}"
                                       styleClass="search-input"/>
                            <p:selectOneMenu value="#{produtoController.filtroCategoria}" 
                                           styleClass="search-input">
                                <f:selectItems value="#{produtoController.categoriasSelectItems}"/>
                            </p:selectOneMenu>
                            <p:commandButton value="Pesquisar" 
                                           icon="pi pi-search"
                                           action="#{produtoController.pesquisar}"
                                           update="tabelaProdutos"
                                           styleClass="p-button-info"/>
                            <p:commandButton value="Limpar" 
                                           icon="pi pi-times"
                                           action="#{produtoController.limparFiltro}"
                                           update="tabelaProdutos"
                                           styleClass="p-button-secondary"/>
                        </p:toolbarGroup>
                    </p:toolbar>

                    <!-- Tabela de Produtos -->
                    <p:dataTable id="tabelaProdutos" 
                               value="#{produtoController.produtos}" 
                               var="produto"
                               selection="#{produtoController.produtoSelecionado}"
                               selectionMode="single"
                               rowKey="#{produto.id}"
                               paginator="true" 
                               rows="10"
                               paginatorPosition="bottom"
                               emptyMessage="Nenhum produto encontrado."
                               styleClass="data-table">
                        
                        <p:column headerText="ID" sortBy="#{produto.id}" width="80">
                            <h:outputText value="#{produto.id}"/>
                        </p:column>

                        <p:column headerText="Nome" sortBy="#{produto.nome}">
                            <h:outputText value="#{produto.nome}"/>
                        </p:column>

                        <p:column headerText="Categoria" sortBy="#{produto.categoria.nome}">
                            <h:outputText value="#{produto.categoria.nome}"/>
                        </p:column>

                        <p:column headerText="Preço" sortBy="#{produto.preco}" width="120">
                            <h:outputText value="#{produto.preco}">
                                <f:convertNumber type="currency" currencySymbol="R$ "/>
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Estoque" sortBy="#{produto.quantidadeEstoque}" width="100">
                            <h:outputText value="#{produto.quantidadeEstoque}"/>
                        </p:column>

                        <p:column headerText="Data Cadastro" sortBy="#{produto.dataCadastro}" width="120">
                            <h:outputText value="#{produto.dataCadastro}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Ações" width="150">
                            <p:commandButton icon="pi pi-pencil" 
                                           title="Editar"
                                           styleClass="p-button-warning p-button-sm"
                                           action="#{produtoController.prepararEdicao}"
                                           update="dialogCadastro"
                                           oncomplete="PF('dialogCadastro').show()">
                                <f:setPropertyActionListener target="#{produtoController.produtoSelecionado}" 
                                                           value="#{produto}"/>
                            </p:commandButton>
                            
                            <p:commandButton icon="pi pi-trash" 
                                           title="Excluir"
                                           styleClass="p-button-danger p-button-sm"
                                           action="#{produtoController.prepararExclusao}"
                                           update="dialogConfirmacao"
                                           oncomplete="PF('dialogConfirmacao').show()">
                                <f:setPropertyActionListener target="#{produtoController.produtoSelecionado}" 
                                                           value="#{produto}"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="layout-footer">
            <span>Sistema de Gerenciamento de Armazém - Produtos</span>
        </div>
    </div>

    <!-- Dialog de Cadastro/Edição -->
    <p:dialog id="dialogCadastro" 
              header="#{produtoController.produto.id == null ? 'Novo Produto' : 'Editar Produto'}"
              widgetVar="dialogCadastro" 
              modal="true" 
              resizable="false"
              width="600"
              showEffect="fade" 
              hideEffect="fade">
        
        <h:form id="formCadastro">
            <p:panelGrid columns="2" styleClass="form-grid">
                <p:outputLabel for="nome" value="Nome:"/>
                <p:inputText id="nome" 
                           value="#{produtoController.produto.nome}" 
                           required="true"
                           requiredMessage="Nome do produto é obrigatório"
                           maxlength="255"
                           styleClass="form-input"/>

                <p:outputLabel for="descricao" value="Descrição:"/>
                <p:inputTextarea id="descricao" 
                               value="#{produtoController.produto.descricao}" 
                               rows="3"
                               maxlength="1000"
                               styleClass="form-input"/>

                <p:outputLabel for="preco" value="Preço:"/>
                <p:inputNumber id="preco" 
                             value="#{produtoController.produto.preco}" 
                             required="true"
                             requiredMessage="Preço é obrigatório"
                             symbol="R$ "
                             decimalSeparator=","
                             thousandSeparator="."
                             decimalPlaces="2"
                             styleClass="form-input"/>

                <p:outputLabel for="quantidade" value="Quantidade em Estoque:"/>
                <p:inputNumber id="quantidade" 
                             value="#{produtoController.produto.quantidadeEstoque}" 
                             required="true"
                             requiredMessage="Quantidade em estoque é obrigatória"
                             decimalPlaces="0"
                             styleClass="form-input"/>

                <p:outputLabel for="categoria" value="Categoria:"/>
                <p:selectOneMenu id="categoria" 
                               value="#{produtoController.produto.categoria}" 
                               required="true"
                               requiredMessage="Categoria é obrigatória"
                               converter="omnifaces.SelectItemsConverter"
                               styleClass="form-input">
                    <f:selectItems value="#{produtoController.categoriasSelectItems}"/>
                </p:selectOneMenu>
            </p:panelGrid>

            <div class="dialog-buttons">
                <p:commandButton value="Salvar" 
                               icon="pi pi-check"
                               action="#{produtoController.salvar}"
                               update="messages tabelaProdutos"
                               oncomplete="if (args.validationFailed) { return; } PF('dialogCadastro').hide();"
                               styleClass="p-button-success"/>
                
                <p:commandButton value="Cancelar" 
                               icon="pi pi-times"
                               action="#{produtoController.cancelar}"
                               oncomplete="PF('dialogCadastro').hide()"
                               immediate="true"
                               styleClass="p-button-secondary"/>
            </div>
        </h:form>
    </p:dialog>

    <!-- Dialog de Confirmação de Exclusão -->
    <p:dialog id="dialogConfirmacao" 
              header="Confirmar Exclusão"
              widgetVar="dialogConfirmacao" 
              modal="true" 
              resizable="false"
              width="400"
              showEffect="fade" 
              hideEffect="fade">
        
        <h:form id="formConfirmacao">
            <div class="confirmation-content">
                <i class="pi pi-exclamation-triangle confirmation-icon"></i>
                <span>Tem certeza que deseja excluir o produto "#{produtoController.produtoSelecionado.nome}"?</span>
            </div>

            <div class="dialog-buttons">
                <p:commandButton value="Sim, Excluir" 
                               icon="pi pi-check"
                               action="#{produtoController.confirmarExclusao}"
                               update="messages tabelaProdutos"
                               oncomplete="PF('dialogConfirmacao').hide()"
                               styleClass="p-button-danger"/>
                
                <p:commandButton value="Cancelar" 
                               icon="pi pi-times"
                               action="#{produtoController.cancelar}"
                               oncomplete="PF('dialogConfirmacao').hide()"
                               immediate="true"
                               styleClass="p-button-secondary"/>
            </div>
        </h:form>
    </p:dialog>
</h:body>
</html>

