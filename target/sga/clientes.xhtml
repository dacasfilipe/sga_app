<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Gerenciamento de Clientes - SGA</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <h:outputStylesheet library="css" name="style.css"/>
</h:head>

<h:body>
    <div class="layout-wrapper">
        <!-- Header -->
        <div class="layout-topbar">
            <div class="layout-topbar-logo">
                <h:link outcome="index">
                    <i class="pi pi-home"></i>
                    <span>SGA - Clientes</span>
                </h:link>
            </div>
            <div class="layout-topbar-menu">
                <h:link outcome="index" styleClass="topbar-link">
                    <i class="pi pi-home"></i>
                    <span>Início</span>
                </h:link>
                <h:link outcome="categorias" styleClass="topbar-link">
                    <i class="pi pi-tags"></i>
                    <span>Categorias</span>
                </h:link>
                <h:link outcome="produtos" styleClass="topbar-link">
                    <i class="pi pi-box"></i>
                    <span>Produtos</span>
                </h:link>
                <h:link outcome="pedidos" styleClass="topbar-link">
                    <i class="pi pi-shopping-cart"></i>
                    <span>Pedidos</span>
                </h:link>
                <h:link outcome="usuarios" styleClass="topbar-link">
                    <i class="pi pi-users"></i>
                    <span>Usuários</span>
                </h:link>
            </div>
        </div>

        <!-- Main Content -->
        <div class="layout-main">
            <div class="layout-content">
                <div class="card">
                    <h1>
                        <i class="pi pi-user"></i>
                        Gerenciamento de Clientes
                    </h1>

                    <p:messages id="messages" showDetail="true" closable="true"/>

                    <!-- Toolbar -->
                    <p:toolbar styleClass="toolbar-actions">
                        <p:toolbarGroup align="left">
                            <p:commandButton value="Novo Cliente" 
                                           icon="pi pi-plus" 
                                           styleClass="p-button-success"
                                           action="#{clienteController.prepararNovo}"
                                           update="dialogCadastro"
                                           oncomplete="PF('dialogCadastro').show()"/>
                        </p:toolbarGroup>
                        
                        <p:toolbarGroup align="right">
                            <p:inputText placeholder="Pesquisar por nome..." 
                                       value="#{clienteController.filtroNome}"
                                       styleClass="search-input"/>
                            <p:commandButton value="Pesquisar" 
                                           icon="pi pi-search"
                                           action="#{clienteController.pesquisar}"
                                           update="tabelaClientes"
                                           styleClass="p-button-info"/>
                            <p:commandButton value="Limpar" 
                                           icon="pi pi-times"
                                           action="#{clienteController.limparFiltro}"
                                           update="tabelaClientes"
                                           styleClass="p-button-secondary"/>
                        </p:toolbarGroup>
                    </p:toolbar>

                    <!-- Tabela de Clientes -->
                    <p:dataTable id="tabelaClientes" 
                               value="#{clienteController.clientes}" 
                               var="cliente"
                               selection="#{clienteController.clienteSelecionado}"
                               selectionMode="single"
                               rowKey="#{cliente.id}"
                               paginator="true" 
                               rows="10"
                               paginatorPosition="bottom"
                               emptyMessage="Nenhum cliente encontrado."
                               styleClass="data-table">
                        
                        <p:column headerText="ID" sortBy="#{cliente.id}" width="80">
                            <h:outputText value="#{cliente.id}"/>
                        </p:column>

                        <p:column headerText="Nome" sortBy="#{cliente.nome}">
                            <h:outputText value="#{cliente.nome}"/>
                        </p:column>

                        <p:column headerText="Email" sortBy="#{cliente.email}">
                            <h:outputText value="#{cliente.email}"/>
                        </p:column>

                        <p:column headerText="Telefone" width="120">
                            <h:outputText value="#{cliente.telefone}"/>
                        </p:column>

                        <p:column headerText="Data Cadastro" sortBy="#{cliente.dataCadastro}" width="120">
                            <h:outputText value="#{cliente.dataCadastro}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Ações" width="150">
                            <p:commandButton icon="pi pi-pencil" 
                                           title="Editar"
                                           styleClass="p-button-warning p-button-sm"
                                           action="#{clienteController.prepararEdicao}"
                                           update="dialogCadastro"
                                           oncomplete="PF('dialogCadastro').show()">
                                <f:setPropertyActionListener target="#{clienteController.clienteSelecionado}" 
                                                           value="#{cliente}"/>
                            </p:commandButton>
                            
                            <p:commandButton icon="pi pi-trash" 
                                           title="Excluir"
                                           styleClass="p-button-danger p-button-sm"
                                           action="#{clienteController.prepararExclusao}"
                                           update="dialogConfirmacao"
                                           oncomplete="PF('dialogConfirmacao').show()">
                                <f:setPropertyActionListener target="#{clienteController.clienteSelecionado}" 
                                                           value="#{cliente}"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="layout-footer">
            <span>Sistema de Gerenciamento de Armazém - Clientes</span>
        </div>
    </div>

    <!-- Dialog de Cadastro/Edição -->
    <p:dialog id="dialogCadastro" 
              header="#{clienteController.cliente.id == null ? 'Novo Cliente' : 'Editar Cliente'}"
              widgetVar="dialogCadastro" 
              modal="true" 
              resizable="false"
              width="600"
              showEffect="fade" 
              hideEffect="fade">
        
        <h:form id="formCadastro">
            <p:panelGrid columns="2" styleClass="form-grid">
                <p:outputLabel for="nome" value="Nome:"/>
                <p:inputText id="nome" 
                           value="#{clienteController.cliente.nome}" 
                           required="true"
                           requiredMessage="Nome do cliente é obrigatório"
                           maxlength="255"
                           styleClass="form-input"/>

                <p:outputLabel for="email" value="Email:"/>
                <p:inputText id="email" 
                           value="#{clienteController.cliente.email}" 
                           required="true"
                           requiredMessage="Email é obrigatório"
                           maxlength="255"
                           styleClass="form-input"/>

                <p:outputLabel for="telefone" value="Telefone:"/>
                <p:inputText id="telefone" 
                           value="#{clienteController.cliente.telefone}" 
                           maxlength="20"
                           styleClass="form-input"/>

                <p:outputLabel for="endereco" value="Endereço:"/>
                <p:inputTextarea id="endereco" 
                               value="#{clienteController.cliente.endereco}" 
                               rows="3"
                               maxlength="1000"
                               styleClass="form-input"/>
            </p:panelGrid>

            <div class="dialog-buttons">
                <p:commandButton value="Salvar" 
                               icon="pi pi-check"
                               action="#{clienteController.salvar}"
                               update="messages tabelaClientes"
                               oncomplete="if (args.validationFailed) { return; } PF('dialogCadastro').hide();"
                               styleClass="p-button-success"/>
                
                <p:commandButton value="Cancelar" 
                               icon="pi pi-times"
                               action="#{clienteController.cancelar}"
                               oncomplete="PF('dialogCadastro').hide()"
                               immediate="true"
                               styleClass="p-button-secondary"/>
            </div>
        </h:form>
    </p:dialog>

    <!-- Dialog de Confirmação de Exclusão -->
    <p:dialog id="dialogConfirmacao" 
              header="Confirmar Exclusão"
              widgetVar="dialogConfirmacao" 
              modal="true" 
              resizable="false"
              width="400"
              showEffect="fade" 
              hideEffect="fade">
        
        <h:form id="formConfirmacao">
            <div class="confirmation-content">
                <i class="pi pi-exclamation-triangle confirmation-icon"></i>
                <span>Tem certeza que deseja excluir o cliente "#{clienteController.clienteSelecionado.nome}"?</span>
            </div>

            <div class="dialog-buttons">
                <p:commandButton value="Sim, Excluir" 
                               icon="pi pi-check"
                               action="#{clienteController.confirmarExclusao}"
                               update="messages tabelaClientes"
                               oncomplete="PF('dialogConfirmacao').hide()"
                               styleClass="p-button-danger"/>
                
                <p:commandButton value="Cancelar" 
                               icon="pi pi-times"
                               action="#{clienteController.cancelar}"
                               oncomplete="PF('dialogConfirmacao').hide()"
                               immediate="true"
                               styleClass="p-button-secondary"/>
            </div>
        </h:form>
    </p:dialog>
</h:body>
</html>

