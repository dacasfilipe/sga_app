<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Gerenciamento de Categorias - SGA</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <h:outputStylesheet library="css" name="style.css"/>
</h:head>

<h:body>
    <div class="layout-wrapper">
        <!-- Header -->
        <div class="layout-topbar">
            <div class="layout-topbar-logo">
                <h:link outcome="index">
                    <i class="pi pi-home"></i>
                    <span>SGA - Categorias</span>
                </h:link>
            </div>
            <div class="layout-topbar-menu">
                <h:link outcome="index" styleClass="topbar-link">
                    <i class="pi pi-home"></i>
                    <span>Início</span>
                </h:link>
                <h:link outcome="produtos" styleClass="topbar-link">
                    <i class="pi pi-box"></i>
                    <span>Produtos</span>
                </h:link>
                <h:link outcome="usuarios" styleClass="topbar-link">
                    <i class="pi pi-users"></i>
                    <span>Usuários</span>
                </h:link>
            </div>
        </div>

        <!-- Main Content -->
        <div class="layout-main">
            <div class="layout-content">
                <div class="card">
                    <h1>
                        <i class="pi pi-tags"></i>
                        Gerenciamento de Categorias
                    </h1>

                    <p:messages id="messages" showDetail="true" closable="true"/>

                    <!-- Toolbar -->
                    <p:toolbar styleClass="toolbar-actions">
                        <p:toolbarGroup align="left">
                            <p:commandButton value="Nova Categoria" 
                                           icon="pi pi-plus" 
                                           styleClass="p-button-success"
                                           action="#{categoriaController.prepararNovo}"
                                           update="dialogCadastro"
                                           oncomplete="PF('dialogCadastro').show()"/>
                        </p:toolbarGroup>
                        
                        <p:toolbarGroup align="right">
                            <p:inputText placeholder="Pesquisar por nome..." 
                                       value="#{categoriaController.filtroNome}"
                                       styleClass="search-input"/>
                            <p:commandButton value="Pesquisar" 
                                           icon="pi pi-search"
                                           action="#{categoriaController.pesquisar}"
                                           update="tabelaCategorias"
                                           styleClass="p-button-info"/>
                            <p:commandButton value="Limpar" 
                                           icon="pi pi-times"
                                           action="#{categoriaController.limparFiltro}"
                                           update="tabelaCategorias"
                                           styleClass="p-button-secondary"/>
                        </p:toolbarGroup>
                    </p:toolbar>

                    <!-- Tabela de Categorias -->
                    <p:dataTable id="tabelaCategorias" 
                               value="#{categoriaController.categorias}" 
                               var="categoria"
                               selection="#{categoriaController.categoriaSelecionada}"
                               selectionMode="single"
                               rowKey="#{categoria.id}"
                               paginator="true" 
                               rows="10"
                               paginatorPosition="bottom"
                               emptyMessage="Nenhuma categoria encontrada."
                               styleClass="data-table">
                        
                        <p:column headerText="ID" sortBy="#{categoria.id}" width="80">
                            <h:outputText value="#{categoria.id}"/>
                        </p:column>

                        <p:column headerText="Nome" sortBy="#{categoria.nome}">
                            <h:outputText value="#{categoria.nome}"/>
                        </p:column>

                        <p:column headerText="Ações" width="150">
                            <p:commandButton icon="pi pi-pencil" 
                                           title="Editar"
                                           styleClass="p-button-warning p-button-sm"
                                           action="#{categoriaController.prepararEdicao}"
                                           update="dialogCadastro"
                                           oncomplete="PF('dialogCadastro').show()">
                                <f:setPropertyActionListener target="#{categoriaController.categoriaSelecionada}" 
                                                           value="#{categoria}"/>
                            </p:commandButton>
                            
                            <p:commandButton icon="pi pi-trash" 
                                           title="Excluir"
                                           styleClass="p-button-danger p-button-sm"
                                           action="#{categoriaController.prepararExclusao}"
                                           update="dialogConfirmacao"
                                           oncomplete="PF('dialogConfirmacao').show()">
                                <f:setPropertyActionListener target="#{categoriaController.categoriaSelecionada}" 
                                                           value="#{categoria}"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="layout-footer">
            <span>Sistema de Gerenciamento de Armazém - Categorias</span>
        </div>
    </div>

    <!-- Dialog de Cadastro/Edição -->
    <p:dialog id="dialogCadastro" 
              header="#{categoriaController.categoria.id == null ? 'Nova Categoria' : 'Editar Categoria'}"
              widgetVar="dialogCadastro" 
              modal="true" 
              resizable="false"
              width="400"
              showEffect="fade" 
              hideEffect="fade">
        
        <h:form id="formCadastro">
            <p:panelGrid columns="2" styleClass="form-grid">
                <p:outputLabel for="nome" value="Nome:"/>
                <p:inputText id="nome" 
                           value="#{categoriaController.categoria.nome}" 
                           required="true"
                           requiredMessage="Nome da categoria é obrigatório"
                           maxlength="255"
                           styleClass="form-input"/>
            </p:panelGrid>

            <div class="dialog-buttons">
                <p:commandButton value="Salvar" 
                               icon="pi pi-check"
                               action="#{categoriaController.salvar}"
                               update="messages tabelaCategorias"
                               oncomplete="if (args.validationFailed) { return; } PF('dialogCadastro').hide();"
                               styleClass="p-button-success"/>
                
                <p:commandButton value="Cancelar" 
                               icon="pi pi-times"
                               action="#{categoriaController.cancelar}"
                               oncomplete="PF('dialogCadastro').hide()"
                               immediate="true"
                               styleClass="p-button-secondary"/>
            </div>
        </h:form>
    </p:dialog>

    <!-- Dialog de Confirmação de Exclusão -->
    <p:dialog id="dialogConfirmacao" 
              header="Confirmar Exclusão"
              widgetVar="dialogConfirmacao" 
              modal="true" 
              resizable="false"
              width="400"
              showEffect="fade" 
              hideEffect="fade">
        
        <h:form id="formConfirmacao">
            <div class="confirmation-content">
                <i class="pi pi-exclamation-triangle confirmation-icon"></i>
                <span>Tem certeza que deseja excluir a categoria "#{categoriaController.categoriaSelecionada.nome}"?</span>
            </div>

            <div class="dialog-buttons">
                <p:commandButton value="Sim, Excluir" 
                               icon="pi pi-check"
                               action="#{categoriaController.confirmarExclusao}"
                               update="messages tabelaCategorias"
                               oncomplete="PF('dialogConfirmacao').hide()"
                               styleClass="p-button-danger"/>
                
                <p:commandButton value="Cancelar" 
                               icon="pi pi-times"
                               action="#{categoriaController.cancelar}"
                               oncomplete="PF('dialogConfirmacao').hide()"
                               immediate="true"
                               styleClass="p-button-secondary"/>
            </div>
        </h:form>
    </p:dialog>
</h:body>
</html>

